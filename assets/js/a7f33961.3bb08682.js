"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[648],{4304:(r,e,t)=>{t.r(e),t.d(e,{assets:()=>c,contentTitle:()=>a,default:()=>f,frontMatter:()=>i,metadata:()=>s,toc:()=>l});var o=t(7624),n=t(2172);const i={},a="RFC-005: Add Terraform to Mono-repository",s={id:"rfc/rfc-005-add-terraform-to-mono-repository",title:"RFC-005: Add Terraform to Mono-repository",description:"Summary",source:"@site/../docs/rfc/rfc-005-add-terraform-to-mono-repository.md",sourceDirName:"rfc",slug:"/rfc/rfc-005-add-terraform-to-mono-repository",permalink:"/rfc/rfc-005-add-terraform-to-mono-repository",draft:!1,unlisted:!1,editUrl:"https://github.com/dvsa/vol-app/tree/main/docs/../docs/rfc/rfc-005-add-terraform-to-mono-repository.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"RFC-004: Conventional Commits",permalink:"/rfc/rfc-004-conventional-commits"}},c={},l=[{value:"Summary",id:"summary",level:2},{value:"Problem",id:"problem",level:2},{value:"Rollback",id:"rollback",level:3},{value:"Duplication &amp; Maintenance",id:"duplication--maintenance",level:3},{value:"Proposal",id:"proposal",level:2},{value:"Scope",id:"scope",level:3},{value:"Terraform Directory Structure",id:"terraform-directory-structure",level:3}];function d(r){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,n.M)(),...r.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e.h1,{id:"rfc-005-add-terraform-to-mono-repository",children:"RFC-005: Add Terraform to Mono-repository"}),"\n",(0,o.jsx)(e.h2,{id:"summary",children:"Summary"}),"\n",(0,o.jsx)(e.p,{children:"This RFC proposes incorporating Terraform into the mono repository to manage infrastructure as code, initially focusing on container-related AWS resources."}),"\n",(0,o.jsx)(e.h2,{id:"problem",children:"Problem"}),"\n",(0,o.jsx)(e.p,{children:"Historically, Terraform has been managed in a separate repository, leading to several challenges:"}),"\n",(0,o.jsx)(e.h3,{id:"rollback",children:"Rollback"}),"\n",(0,o.jsx)(e.p,{children:"The Terraform repository lacks automated versioning alignment with application code, complicating understanding of infrastructure state at specific points in time. This creates challenges during rollbacks or deploying older application versions for testing, as it necessitates running two independent workflows in a specific sequence, contradicting the principles of continuous delivery (CD)."}),"\n",(0,o.jsx)(e.h3,{id:"duplication--maintenance",children:"Duplication & Maintenance"}),"\n",(0,o.jsx)(e.p,{children:"Maintaining separate repositories necessitates duplicating GitHub Action workflows across them to apply changes to both application and infrastructure. Each repository must also check out code from the other, typically requiring the application code to utilize a Personal Access Token (PAT) for accessing private infrastructure code, adding to maintenance overhead."}),"\n",(0,o.jsx)(e.h2,{id:"proposal",children:"Proposal"}),"\n",(0,o.jsx)(e.p,{children:"Building on the proposal from RFC-001, Terraform, limited to the scope below, will be integrated into the mono repository to manage infrastructure as code."}),"\n",(0,o.jsx)(e.h3,{id:"scope",children:"Scope"}),"\n",(0,o.jsx)(e.p,{children:"This RFC will cover resources created with the following Terraform modules:"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:(0,o.jsx)(e.a,{href:"https://github.com/terraform-aws-modules/terraform-aws-ecr",children:"https://github.com/terraform-aws-modules/terraform-aws-ecr"})}),"\n",(0,o.jsx)(e.li,{children:(0,o.jsx)(e.a,{href:"https://github.com/terraform-aws-modules/terraform-aws-ecs",children:"https://github.com/terraform-aws-modules/terraform-aws-ecs"})}),"\n",(0,o.jsx)(e.li,{children:(0,o.jsx)(e.a,{href:"https://github.com/terraform-aws-modules/terraform-aws-batch",children:"https://github.com/terraform-aws-modules/terraform-aws-batch"})}),"\n"]}),"\n",(0,o.jsx)(e.p,{children:"Any resources that support the above work can be included without requiring a new RFC. Subsequent RFCs should be created for larger collections of resources, such as networking or databases."}),"\n",(0,o.jsx)(e.h3,{id:"terraform-directory-structure",children:"Terraform Directory Structure"}),"\n",(0,o.jsxs)(e.p,{children:["Terraform files will reside in the ",(0,o.jsx)(e.code,{children:"infra/terraform"})," directory, organized as follows:"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-js",children:"|-- `terraform/`\n|       |-- `accounts/`\n|       |       |-- `nonprod/`\n|       |       |       |-- `backend.tf`\n|       |       |       |-- `main.tf`\n|       |       |       |-- `outputs.tf`\n|       |       |       |-- `provider.tf`\n|       |       |       |-- `variables.tf`\n|       |       |       |-- ...\n|       |       |-- `prod/`\n|       |       |       |-- `backend.tf`\n|       |       |       |-- `main.tf`\n|       |       |       |-- `outputs.tf`\n|       |       |       |-- `provider.tf`\n|       |       |       |-- `variables.tf`\n|       |       |       |-- ...\n|       |-- `environments/`\n|       |       |-- `dev/`\n|       |       |       |-- `backend.tf`\n|       |       |       |-- `main.tf`\n|       |       |       |-- `outputs.tf`\n|       |       |       |-- `provider.tf`\n|       |       |       |-- `variables.tf`\n|       |       |       |-- ...\n|       |       |-- `int/`\n|       |       |       |-- `backend.tf`\n|       |       |       |-- `main.tf`\n|       |       |       |-- `outputs.tf`\n|       |       |       |-- `provider.tf`\n|       |       |       |-- `variables.tf`\n|       |       |       |-- ...\n|       |       |-- `prep/`\n|       |       |       |-- `backend.tf`\n|       |       |       |-- `main.tf`\n|       |       |       |-- `outputs.tf`\n|       |       |       |-- `provider.tf`\n|       |       |       |-- `variables.tf`\n|       |       |       |-- ...\n|       |       |-- `prod/`\n|       |       |       |-- `backend.tf`\n|       |       |       |-- `main.tf`\n|       |       |       |-- `outputs.tf`\n|       |       |       |-- `provider.tf`\n|       |       |       |-- `variables.tf`\n|       |       |       |-- ...\n|       |       |-- ...\n|       |-- `modules/`\n|       |       |-- `account/`\n|       |       |       |-- `main.tf`\n|       |       |       |-- `outputs.tf`\n|       |       |       |-- `provider.tf`\n|       |       |       |-- `variables.tf`\n|       |       |       |-- ...\n|       |       |-- `service/`\n|       |       |       |-- `main.tf`\n|       |       |       |-- `outputs.tf`\n|       |       |       |-- `provider.tf`\n|       |       |       |-- `variables.tf`\n|       |       |       |-- ...\n|       |       |-- ...\n"})})]})}function f(r={}){const{wrapper:e}={...(0,n.M)(),...r.components};return e?(0,o.jsx)(e,{...r,children:(0,o.jsx)(d,{...r})}):d(r)}}}]);